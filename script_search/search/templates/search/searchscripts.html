{% extends "searchtemplate.html" %}

{% block additional_head %}
<script type="text/javascript">
  let all_checked = false;
  let checkboxes = null;

  function selectAll() {
    if (!checkboxes) {
      checkboxes = document.querySelectorAll('input[type=checkbox][name=chk_result]')
    }

    for (let i = 0; i < checkboxes.length; i++) {
      checkboxes[i].checked = !all_checked;
    }

    all_checked = !all_checked
  }
</script>
{% endblock %}

{% block content %}
<h1>Search Scripts</h1>

<form name="form" action="" method="POST">
  {% csrf_token %}
  {{ form }}
  <div>
    <button type="submit" name="search">Search</button>
  </div>
  <div>
    <button type="submit" name="export">Export</button>
  </div>
  {% if results and results.search_results %}
  <span>{{ results.snippet_hits }} results in {{ results.script_hits }} scripts in {{ elapsed }} seconds</span>
  <table id="results_table">
    <tr>
      <th><input type="checkbox" name="chk_selectall" onclick="selectAll();" /></th>
      <th>Kind</th>
      <th>Title</th>
      <th>Year</th>
      <th>Season</th>
      <th>Episode</th>
      <th>Text</th>
    </tr>
    {% for search_result in results.search_results %}
    <tr>
      <td><input type="checkbox" name="chk_result" value="{{search_result.id}}" /></td>
      <td>{% if search_result.script_type == 'T' %} TV {% else %} Movie {% endif %}</td>
      <td>{{ search_result.title }}</td>
      <td>{{ search_result.year }}</td>
      <td>{% if search_result.script_type == 'T' %} {{ search_result.season }} {% endif %}</td>
      <td>{% if search_result.script_type == 'T' %} {{ search_result.episode }} {% endif %}</td>
      <td>
        <table>
          {% autoescape off %}
          {% for snippet in search_result.headline %}
            <tr>
              <td>
                {{ snippet }}
              </td>
            </tr>
          {% endfor %}
          {% endautoescape %}
        </table>
      </td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}
</form>

{% endblock %}
